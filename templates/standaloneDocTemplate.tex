\documentclass{article}

\usepackage{amsmath}    % need for subequations
\usepackage{graphicx}   % need for figures
\usepackage{verbatim}   % useful for program listings
\usepackage{color}      % use if color is used in text
\usepackage{subfigure}  % use for side-by-side figures
\usepackage{hyperref}   % use for hypertext links, including those to external documents and URLs
\usepackage[spanish]{babel}
\usepackage{cancel}
\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage[section]{placeins} %esto evita que imagenes se salgan de su seccion
\usepackage{cite} %referencias
\usepackage{hyperref}
\usepackage{amsfonts}
\usepackage{listings}
\everymath{\displaystyle}

%\usepackage{epstopdf}
\input{C:/Users/pablo/Ingenieria/Latex/include}
\graphicspath{{C:/Users/pablo/Ingenieria/Latex/}{./figuras/}}

\usepackage{float}
 
%\setlength\parindent{0pt} %esto hace la sangria nula

\begin{document}
\thispagestyle{empty}
%\vspace*{-1cm}
%\vspace*{-2cm}

\vspace*{-1cm}
\includegraphics[width=2cm]{logo_PUC.pdf}
\vspace*{-2cm}

\hspace*{2cm}
 \begin{tabular}{l}
  {\ Pontificia Universidad Católica de Chile}\\
  {\ Escuela de Ingeniería}\\
  {\ Departamento de Ingeniería Eléctrica}\\
  {\ Magister en Ciencias de la Ingeniería }\\
  {\  }\\
 \end{tabular}
 \hfill 
\vspace*{-0.2cm}
\begin{center}
{\Large\bf Problema de Optimización}\\
\vspace*{2mm}
{\Large Tesis de Postgrado}\\
%\vspace*{3mm}
{15 de diciembre de 2017}\\
\vspace*{1mm}
{\bf Pablo Diaz - 12634581 }\\
\vspace*{1mm}
\end{center}
\hrule\vspace*{2pt}\hrule
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% ENCABEZADO %%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newpage
\setcounter{page}{1}
%\tableofcontents
%\newpage

\section{Formulación MPC}
\subsection{Caldera}
\begin{description}
\item[Variables Controladas] Las variables controladas son presión de vapor, nivel de oxígeno y nivel de agua.
\item[Variables Manipuladas] Las variables manipuladas son combustible, flujo de aire y flujo de agua.
\item[Perturbaciones medidas] La perturbación medida es la demanda de vapor.
\item[Perturbaciones no medidas] A los 90 minutos de operación, se produce un cambio en las propiedades del combustible.

\end{description}
El control de la caldera es un problema con las siguientes dimensiones:

\bseq{}\label{eq:calderaDims}
\begin{gather}
y \in \corch{0,100} \times \corch{0,100} \times \corch{0,100}\\
u \in \corch{0,100} \times  \corch{0,100} \times \corch{0,100}\\
p \in \corch{0,100}\\
\dot{x}(t) = f(x,u), x(0) = x_0
\end{gather}
\eseq{}
Dependiendo del método de identificación de sistemas, se hará uso o no del modelo en espacio de estados (para N4SID se utiliza este modelo). El modelo es no lineal; sin embargo, para efectos de planta de prueba interesa solo un punto de operación, caracterizado por:
\bseq{}\label{eq:opPointCaldera}
\begin{gather}
 y_0 = \corch{41.41 ; 28.75 ;38.60}\\
 u_0 = \corch{32.98 ; 46.22 ;25.34}\\
 d_0 = 35.78
\end{gather}
\eseq{}

\subsubsection{Formulación Restricciones}
En el concurso, se establecen las siguientes restricciones:
\bseq{}\label{eq:restriccionesCaldera}
\begin{gather}
\vabs{\Delta u_i(k)} \leq 1 \:\text{pps} \: \forall i\\
 0.95y_{2_0} \leq y_2 \leq 1.05y_{2_0}
\end{gather}
\eseq{}

Estas restricciones representan un conjunto convexo y lineal de restricciones.

\subsubsection{Formulación Modelo Entrada-Salida}
En el caso del uso de \textit{random forests}, no se utiliza la formulación en espacio de estados. Se utiliza en cambio un modelo entrada-salida \textbf{no lineal y no diferenciable}:

$$y(k+1) = f_{RF}(\squig{u(k-d_u), d_u = {0,\cdots, n_u}  },\squig{y(k-d_y), d_u = {0,\cdots, n_y}},\squig{p(k-d_u), d_p = {0,\cdots, n_p}})$$

En la notación anterior se intenta dejar de forma explícita el uso de valores pasados de las entradas y valores pasados de las salidas. Esto guarda estricta relación con las formulaciones ARMAX y (dependiendo de las propiedades del ruido) CARIMA del control MPC clásico.

La metodología para la obtención del modelo predictivo en base a \textit{random forests} es la siguiente:
\begin{enumerate}
\item Generación de excitaciones sobre la planta de prueba de distinta forma (sinusoidales, cuadradas, escalones y diente de sierra). Estas señales se generan de forma apropiada para que no violen los rangos establecidos para la planta. El proceso se somete a estas excitaciones y combinaciones de ellas simultáneamente, registrándose las salidas.
\item Recopilación de datos entrada-salida.
\item Especificación del llamado \qt{tiempo efectivo de reacción} $\tau_r$. Este tiempo se puede entender análogamente a una constante de tiempo en sistemas lineales: pasado un tiempo efectivo de reacción se observa un cambio razonable en las variables. El tiempo efectivo de reacción se eligió como 5 veces el tiempo de muestreo del sistema (0.5 segundos).
\item Alimentación a algoritmo de \textit{random forests} de las series de tiempo de las señales y combinaciones de estas retrasadas (múltiplos de $\tau_r$). Las combinaciones son elegidas de forma representativa y arbitraria. Este algoritmo se hace con hiper-parámetros estandarizados de 100 árboles y tamaño mínimo de hoja de 10 muestras.
\item Cálculo de métricas relevantes de error: MSE, coeficiente de correlación y \textit{out of bag error}.
\item Selección en base a mejor criterio de métrica escogida (MSE) de los mejores $\kappa_y$ modelos para cada variable $y$.
\item Optimización bayesiana de los hiper-parámetros de los $\kappa_y$ modelos escogidos.
\item Cálculo de mismas métricas de error y selección del mejor modelo $f_y$ para cada variable $y$.
\end{enumerate}

El modelo predictivo obtenido en base a \textit{random forests} actualmente se encuentra en un estado sub-óptimo por los siguientes motivos:
\begin{itemize}
\item Horizonte de simulación quizás insuficiente.
\item Falta de optimización bayesiana del primer conjunto de mejores modelos $\kappa_y$.
\end{itemize}

Una vez obtenido el modelo $f_{RF}$ que es un predictor \textbf{a un paso}, se \qt{eleva} su horizonte de predicción a $N_y$ pasos realimentando las salidas predichas $\hat{y}(k+j)$, $j = {1,\cdots,N_y}$. Existe también un horizonte de control $N_u$. Se tienen las siguientes consideraciones:
\begin{itemize}
\item Cuando $j > N_u$, se asume que las variables manipuladas quedan constantes. En otras palabras, $$\Delta u(k+j) = 0 \: \forall j > N_u$$
\item Las $N_y$ predicciones se pueden ver como $N_y$ \textbf{restricciones} que relacionan las entradas con las salidas. Estas restricciones son del tipo no lineal (debido a la función $f_{RF}$) y por lo tanto hacen necesario otros métodos de optimización.
\item Una primera aproximación podría ser basada en los principios de Bellman y programación dinámica: fijar $u(k)$ y optimizar para esta variable en primera instancia. Una vez encontrado el óptimo para esta (y habiendo asumido que la entrada permanece igual en todo el horizonte $N_y$), optimizar para $u(k+1)$ y así sucesivamente. Esta noción de metodología es búsqueda local de soluciones óptimas; sin embargo, existen métodos que lo transforman en búsqueda global.
\item Otra alternativa (basada por ejemplo en algoritmos genéticos y \textit{pattern search}) es la minimización de todo el vector $u(k+j)$ simultáneamente. Esta será la alternativa preferida.
\end{itemize}

\subsubsection{Función Objetivo}
Se especificarán dos funciones objetivos distintas (dos controladores y experiencias distintas):
\begin{description}
\item[Función objetivo cuadrática] La primera formulación será utilizando el MPC para garantizar estabilidad del sistema mediante una función objetivo cuadrática, de la forma:

\bseq{}\label{eq:funcObj1Caldera}
\begin{gather}
min_{u}J(u,y) = \sum_{k = 1}^{N_y}\ptsis{y(t+k)-w(t+k)}^2+\lambda \sum_{k = 0}^{N_u}\ptsis{\Delta u(t+k)}^2
\end{gather}
\eseq{}

%{\color{red}Dudas pendientes}:
%\begin{itemize}
%\item Inclusión de términos $\epsilon_j$ en restricciones de $y(k+j)$ como variables de holgura en restricciones. Penalización de estos en la función de costos. Inspirado en Jain y paper de MPC-RF.
%\item 
%\end{itemize}

\item[Función objetivo lineal] Esta formulación es la final e ideal, pues corresponde a una arquitectura de control en dos niveles (nivel estabilizante regulatorio y nivel optimizante). 
\end{description}
\end{document}